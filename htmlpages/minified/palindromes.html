<h2>Introduction</h2><p>A common coding interview task is to write code that tells you whether a given string is a palindrome. It is easy to see why: it is a great way to showcase knowledge of regular expressions and reshaping data. Additionally, I think it`s a great time to introduce the idea of <a href=https://r-pkgs.org/testing-basics.html>testing</a> in R.<h2>Testing</h2><p>Testing is a great way to automate the "spot checks" your code has to make sure things are running properly. Since data science and analysis can go unexpected places, it is not always possible to implement unit tests for every task. However, I still think they are underutilized. For example, I frequently create CSV files with a series a regular expressions I want to evaluate. When I add to that list, unit tests make it easy to ensure I'm not breaking previously-written code. Good code is consistent and accurate. Please do not give me research assignments in the middle of your code! If you feel the need to check the results at each run, that`s a good sign the code is not ready yet. In this post, we will be using <a href=https://testthat.r-lib.org/ >testthat</a> to implement unit testing. testthat is mostly built for package development, but now is a good time to introduce it. Plus, it has some features built in to make unit testing a little more fun.<h2>Palindromes: Setting up tests</h2><p>Next, let`s set up our test cases. Some Googling brought me to <a href=http://www.palindromelist.net/ >palindromelist.net</a>. I noticed that punctuation and capitalization are disregarded in these lists. For this blog, I will assume that only the letters of the alphabet matter in determining whether or not a word is a palindrome. Let`s use a sample of entries from the website to test our palindrome function. We also want to make sure the function correctly identifies words that are NOT palindromes, so let`s add in a test for words that should return FALSE. Finally, if the supplied value is not a character vector, an error should be returned.<div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r>library<span class="token punctuation">(</span>testthat<span class="token punctuation">)</span>

<span class="token comment"># Start with writing unit tests!</span>
run_tests <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>myfun<span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token comment"># These should all return TRUE</span>
test_that<span class="token punctuation">(</span><span class="token string">'Works on real palindromes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment"># If a test fails, this prints</span>
  palindromes <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span>
    <span class="token string">'kayak'</span><span class="token punctuation">,</span> <span class="token string">'deified'</span><span class="token punctuation">,</span> <span class="token string">'rotator'</span><span class="token punctuation">,</span> <span class="token string">'repaper'</span><span class="token punctuation">,</span> <span class="token string">'deed'</span><span class="token punctuation">,</span> <span class="token string">'peep'</span><span class="token punctuation">,</span> 
    <span class="token string">'wow'</span><span class="token punctuation">,</span> <span class="token string">'noon'</span><span class="token punctuation">,</span> <span class="token string">'civic'</span><span class="token punctuation">,</span> <span class="token string">'racecar'</span><span class="token punctuation">,</span> <span class="token string">'level'</span><span class="token punctuation">,</span> <span class="token string">'mom'</span><span class="token punctuation">,</span> 
    <span class="token string">'bird rib'</span><span class="token punctuation">,</span> <span class="token string">'taco cat'</span><span class="token punctuation">,</span> <span class="token string">'UFO tofu'</span><span class="token punctuation">,</span> <span class="token string">'Borrow or rob?'</span><span class="token punctuation">,</span> 
    <span class="token string">'Never odd or even.'</span><span class="token punctuation">,</span> <span class="token string">'We panic in a pew.'</span><span class="token punctuation">,</span> 
    <span class="token string">'Won`t lovers revolt now?'</span><span class="token punctuation">,</span>  
    <span class="token string">'Ma is a nun, as I am.'</span><span class="token punctuation">,</span> <span class="token string">'Don`t nod.'</span><span class="token punctuation">,</span> 
    <span class="token string">'Sir, I demand, I am a maid named Iris.'</span><span class="token punctuation">,</span> 
    <span class="token string">'Was it a car or a cat I saw?'</span><span class="token punctuation">,</span> <span class="token string">'Yo, Banana Boy!'</span><span class="token punctuation">,</span> 
    <span class="token string">'Eva, can I see bees in a cave?'</span><span class="token punctuation">,</span> 
    <span class="token string">'Madam, in Eden, I`m Adam.'</span><span class="token punctuation">,</span> 
    <span class="token string">'A man, a plan, a canal, Panama!'</span><span class="token punctuation">,</span> 
    <span class="token string">'Never a foot too far, even.'</span><span class="token punctuation">,</span>
    <span class="token string">'Red roses run no risk, sir, on Nurse`s order.'</span><span class="token punctuation">,</span> 
    <span class="token string">'He lived as a devil, eh?'</span><span class="token punctuation">,</span> <span class="token string">'Ned, I am a maiden.'</span><span class="token punctuation">,</span> 
    <span class="token string">'Now, sir, a war is won!'</span><span class="token punctuation">,</span> <span class="token string">'Evade me, Dave!'</span><span class="token punctuation">,</span> 
    <span class="token string">'Dennis and Edna sinned.'</span><span class="token punctuation">,</span> <span class="token string">'Step on no pets!'</span><span class="token punctuation">,</span> <span class="token string">'ää'</span><span class="token punctuation">)</span>
funx <span class="token operator">&lt;-</span> myfun
expect_equal<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span>palindromes<span class="token punctuation">)</span><span class="token punctuation">,</span> rep<span class="token punctuation">(</span><span class="token boolean">TRUE</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>palindromes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Ensure it returns False when it should</span>
test_that<span class="token punctuation">(</span><span class="token string">'Works on non-palindromes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  antipalindromes <span class="token operator">&lt;-</span> c<span class="token punctuation">(</span><span class="token string">'cat'</span><span class="token punctuation">,</span> <span class="token string">'dog'</span><span class="token punctuation">,</span> <span class="token string">'Mustard'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> character<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  expect_equal<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span>antipalindromes<span class="token punctuation">)</span><span class="token punctuation">,</span> rep<span class="token punctuation">(</span><span class="token boolean">FALSE</span><span class="token punctuation">,</span> length<span class="token punctuation">(</span>antipalindromes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Make sure error is thrown if non-character used</span>
test_that<span class="token punctuation">(</span><span class="token string">'Error if not character'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  expect_error<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  expect_error<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  expect_error<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span><span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  expect_error<span class="token punctuation">(</span>myfun<span class="token punctuation">(</span>Sys.Date<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><p>Note the function names that read like English. It`s one of the many nice things about the testthat package. Typically, in package development, you would store all of your tests in the <code>mypackage/tests/testthat</code> directory. Above, we placed all unit tests in a single <code>run_tests()</code> function. This is for convenience and to allow testing and function writing to happen in a single script.<p>Before we move on to writing a function, let`s take a step back and think about all of the benefits of writing these tests. The simple act of gathering some test cases made us think about the things that make this `easy` task hard: capitalization, spaces, punctuation, and empty strings to name a few. I will confess, my first version of this function would have failed on the of the 4 pitfalls I just mentioned. I`m glad I finally took the time to step back and write good tests!<h2>Function is_palindrome</h2><div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r><span class="token comment"># Write a function to determine whether a particular word is a palindrome</span>
is_palindrome <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment"># Check that a character input was provided</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>is.character<span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    stop<span class="token punctuation">(</span><span class="token string">'That is not valid input. Please try again.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment"># Strip out non-alpha characters, convert to lower case, check equivalency</span>
  newword <span class="token operator">&lt;-</span> tolower<span class="token punctuation">(</span>gsub<span class="token punctuation">(</span><span class="token string">'\\W'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> word<span class="token punctuation">)</span><span class="token punctuation">)</span>
  rev_words <span class="token operator">&lt;-</span> do.call<span class="token punctuation">(</span>c<span class="token punctuation">,</span> 
                       lapply<span class="token punctuation">(</span>newword<span class="token punctuation">,</span> 
                              <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                paste<span class="token punctuation">(</span>rev<span class="token punctuation">(</span>strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">NULL</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                                      collapse <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
                                <span class="token punctuation">}</span>
                              <span class="token punctuation">)</span><span class="token punctuation">)</span>
  out <span class="token operator">&lt;-</span> tolower<span class="token punctuation">(</span>newword<span class="token punctuation">)</span> <span class="token operator">==</span> tolower<span class="token punctuation">(</span>rev_words<span class="token punctuation">)</span>
  out<span class="token punctuation">[</span>which<span class="token punctuation">(</span>newword <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">&lt;-</span> <span class="token boolean">FALSE</span>
  return<span class="token punctuation">(</span>out<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment"># Try it out on a few samples</span>
is_palindrome<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token string">'Jon'</span><span class="token punctuation">,</span> <span class="token string">'apple'</span><span class="token punctuation">,</span> <span class="token string">'sos'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><div class=code-toolbar><pre class=language-bash tabindex=0><code class=language-bash><span class="token comment">## [1] FALSE FALSE  TRUE</span></code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r><span class="token comment"># And run our comprehensive testing function from above!</span>
run_tests<span class="token punctuation">(</span>is_palindrome<span class="token punctuation">)</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r><span class="token comment">## Test passed 🥇</span>
<span class="token comment">## Test passed 😸</span>
<span class="token comment">## Test passed 😸</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><p>And there you have it! A vectorized, flexible function to identify palindromes, all ready to go. Well, almost…we forgot about characters not in the English alphabet! I won`t pretend to know any foreign languages (I`m barely literate in English and R), but it would at least be nice for it to work in other languages in theory. Perhaps a new test might look something like:<div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r><span class="token comment"># A lazy example, I will admit</span>
library<span class="token punctuation">(</span>waldo<span class="token punctuation">)</span> <span class="token comment"># For foreign characters</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div><div class=code-toolbar><pre class=language-r tabindex=0><code class=language-r><span class="token comment">## Warning: package 'waldo' was built under R version 4.2.1</span>
<span class="token comment">## </span>
<span class="token comment">## Attaching package: 'waldo'</span>
<span class="token comment">## The following object is masked from 'package:testthat':</span>
<span class="token comment">##     compare</span>
test_that<span class="token punctuation">(</span><span class="token string">'Non-english characters are okay'</span><span class="token punctuation">,</span>
          expect_true<span class="token punctuation">(</span>is_palindrome<span class="token punctuation">(</span><span class="token string">'ää'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">## Test passed 🌈</span>
</code></pre><div class=toolbar><div class=toolbar-item><button class=copy-to-clipboard-button data-copy-state=copy type=button><span>Copy</span></button></div></div></div>
